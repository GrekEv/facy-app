# üîå –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å SSH —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º

## –ü—Ä–æ–±–ª–µ–º–∞: "Connection closed" / "Broken pipe"

–ï—Å–ª–∏ SSH —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π:
```
Connection to 158.160.96.182 closed.
client_loop: send disconnect: Broken pipe
```

## üîç –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. **–¢–∞–π–º–∞—É—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏** - —Å–µ—Ä–≤–µ—Ä –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
2. **–ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é** - –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
3. **–°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–ª—Å—è** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
4. **–ü—Ä–æ–±–ª–µ–º—ã —Å –≥—Ä—É–ø–ø–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** - –ø—Ä–∞–≤–∏–ª–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
5. **–ü—Ä–æ–±–ª–µ–º—ã —Å SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π** - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## ‚úÖ –†–µ—à–µ–Ω–∏—è:

### –†–µ—à–µ–Ω–∏–µ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH Keepalive (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSH –∫–ª–∏–µ–Ω—Ç –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:

**–ù–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ (Mac/Linux):**

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `~/.ssh/config`:
```bash
nano ~/.ssh/config
```

2. –î–æ–±–∞–≤—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞:
```
Host 158.160.96.182
    ServerAliveInterval 60
    ServerAliveCountMax 3
    TCPKeepAlive yes
    ConnectTimeout 10
```

–ò–ª–∏ –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤:
```
Host *
    ServerAliveInterval 60
    ServerAliveCountMax 3
    TCPKeepAlive yes
```

3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª: `Ctrl+O`, `Enter`, `Ctrl+X`

**–ß—Ç–æ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- `ServerAliveInterval 60` - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç keepalive –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
- `ServerAliveCountMax 3` - —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ 3 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- `TCPKeepAlive yes` - –≤–∫–ª—é—á–∞–µ—Ç TCP keepalive
- `ConnectTimeout 10` - —Ç–∞–π–º–∞—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è 10 —Å–µ–∫—É–Ω–¥

**–ù–∞ Windows (PowerShell):**

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `C:\Users\–í–∞—à–µ–ò–º—è\.ssh\config` (–±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è) —Å —Ç–µ–º –∂–µ —Å–æ–¥–µ—Ä–∂–∏–º—ã–º.

### –†–µ—à–µ–Ω–∏–µ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:**

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo nano /etc/ssh/sshd_config

# –ù–∞–π–¥–∏—Ç–µ –∏ –∏–∑–º–µ–Ω–∏—Ç–µ/–¥–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏:
ClientAliveInterval 60
ClientAliveCountMax 3
TCPKeepAlive yes

# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ SSH:
sudo systemctl restart sshd
```

**–ß—Ç–æ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- `ClientAliveInterval 60` - —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
- `ClientAliveCountMax 3` - —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ 3 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
- `TCPKeepAlive yes` - –≤–∫–ª—é—á–∞–µ—Ç TCP keepalive

### –†–µ—à–µ–Ω–∏–µ 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ tmux –∏–ª–∏ screen

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `tmux` –∏–ª–∏ `screen` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–π:

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ tmux –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
```bash
sudo apt update
sudo apt install -y tmux
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh ubuntu@158.160.96.182

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ tmux
tmux

# –¢–µ–ø–µ—Ä—å –¥–∞–∂–µ –µ—Å–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–∑–æ—Ä–≤–µ—Ç—Å—è, –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Å—Å–∏—é:
# –ü–æ—Å–ª–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
tmux attach
```

**–ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã tmux:**
- `Ctrl+B` –∑–∞—Ç–µ–º `D` - –æ—Ç—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –æ—Ç —Å–µ—Å—Å–∏–∏ (—Å–µ—Å—Å–∏—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å)
- `tmux ls` - —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π
- `tmux attach -t 0` - –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Å—Å–∏–∏ 0
- `Ctrl+B` –∑–∞—Ç–µ–º `X` - –∑–∞–∫—Ä—ã—Ç—å —Å–µ—Å—Å–∏—é

### –†–µ—à–µ–Ω–∏–µ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä—É–ø–ø –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≥—Ä—É–ø–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

1. **–í –∫–æ–Ω—Å–æ–ª–∏ –Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–∞:**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **"Virtual Private Cloud"** ‚Üí **"–ì—Ä—É–ø–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"**
   - –ù–∞–π–¥–∏—Ç–µ –≥—Ä—É–ø–ø—É –≤–∞—à–µ–π –í–ú
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –µ—Å—Ç—å –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –ø–æ—Ä—Ç–∞ 22 (SSH):
     - **–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –í—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫
     - **–ü—Ä–æ—Ç–æ–∫–æ–ª:** TCP
     - **–ü–æ—Ä—Ç:** 22
     - **–ò—Å—Ç–æ—á–Ω–∏–∫:** –í–∞—à IP –∏–ª–∏ `0.0.0.0/0`

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –í–ú:**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –í–ú —Ä–∞–±–æ—Ç–∞–µ—Ç (—Å—Ç–∞—Ç—É—Å "–†–∞–±–æ—Ç–∞–µ—Ç")
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—É–±–ª–∏—á–Ω—ã–π IP –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è

### –†–µ—à–µ–Ω–∏–µ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ ping
ping 158.160.96.182

# –ü—Ä–æ–≤–µ—Ä–∫–∞ SSH –ø–æ—Ä—Ç–∞
nc -zv 158.160.96.182 22

# –ò–ª–∏ —Å —Ç–∞–π–º–∞—É—Ç–æ–º
timeout 5 bash -c "</dev/tcp/158.160.96.182/22" && echo "–ü–æ—Ä—Ç –æ—Ç–∫—Ä—ã—Ç" || echo "–ü–æ—Ä—Ç –∑–∞–∫—Ä—ã—Ç"
```

**–ï—Å–ª–∏ –ø–æ—Ä—Ç –∑–∞–∫—Ä—ã—Ç:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥—Ä—É–ø–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –í–ú –∑–∞–ø—É—â–µ–Ω–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: `sudo ufw status`

### –†–µ—à–µ–Ω–∏–µ 6: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ autossh (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ autossh:**
```bash
# –ù–∞ Mac
brew install autossh

# –ù–∞ Linux
sudo apt install autossh
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
autossh -M 20000 -f -N -o "ServerAliveInterval 60" -o "ServerAliveCountMax 3" ubuntu@158.160.96.182
```

–ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ `~/.ssh/config`:
```
Host 158.160.96.182
    ServerAliveInterval 60
    ServerAliveCountMax 3
    ExitOnForwardFailure yes
```

## üîß –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ ping
ping -c 4 158.160.96.182

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ SSH –ø–æ—Ä—Ç–∞
nc -zv 158.160.96.182 22

# 3. –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
ssh -v ubuntu@158.160.96.182

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å —Ç–∞–π–º–∞—É—Ç–æ–º
ssh -o ConnectTimeout=10 ubuntu@158.160.96.182
```

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
```bash
# –ü–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É
sudo tail -f /var/log/auth.log
# –∏–ª–∏
sudo journalctl -u ssh -f
```

## üìù –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:**

**`~/.ssh/config` –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:**
```
Host 158.160.96.182
    HostName 158.160.96.182
    User ubuntu
    ServerAliveInterval 60
    ServerAliveCountMax 3
    TCPKeepAlive yes
    ConnectTimeout 10
    Compression yes
    ForwardAgent yes
```

**`/etc/ssh/sshd_config` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
```
ClientAliveInterval 60
ClientAliveCountMax 3
TCPKeepAlive yes
MaxStartups 10:30:100
```

## ‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: "Connection timed out"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥—Ä—É–ø–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ firewall

### –ü—Ä–æ–±–ª–µ–º–∞: "Permission denied"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH –∫–ª—é—á: `ssh-add -l`

### –ü—Ä–æ–±–ª–µ–º–∞: "Host key verification failed"
**–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–π –∫–ª—é—á: `ssh-keygen -R 158.160.96.182`

### –ü—Ä–æ–±–ª–µ–º–∞: –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –†–µ—à–µ–Ω–∏–µ 1 (SSH Keepalive)

## üöÄ –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ

**–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± - –¥–æ–±–∞–≤–∏—Ç—å –≤ `~/.ssh/config`:**
```
Host *
    ServerAliveInterval 60
    ServerAliveCountMax 3
```

–≠—Ç–æ —Ä–µ—à–∏—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø—Ä–æ–±–ª–µ–º —Å —Ä–∞–∑—Ä—ã–≤–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è!


