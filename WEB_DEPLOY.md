# ๐ ะะฐะทะฒะตัััะฒะฐะฝะธะต ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธั

## ๐ ะััะธัะตะบัััะฐ

### ะขะตะบััะฐั ััััะบัััะฐ:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   ะฏะฝะดะตะบั.ะะฑะปะฐะบะพ (ะะ)                โ
โ   IP: 158.160.96.182                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                     โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ โ
โ  โ  Docker API  โ  โ Docker Bot  โ โ
โ  โ  Port 8000   โ  โ             โ โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ โ
โ         โ                  โ         โ
โ         โโโโโโโโโโฌโโโโโโโโโโ         โ
โ                  โ                   โ
โ         โโโโโโโโโโผโโโโโโโโโ         โ
โ         โ  SQLite ะะ       โ         โ
โ         โ  data/app.db     โ         โ
โ         โโโโโโโโโโโโโโโโโโโ         โ
โ                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะะฐะถะฝะพ:** 
- ะกะตัะฒะตั ะฝะฐ ะฏะฝะดะตะบั.ะะฑะปะฐะบะต โ ััะพ **ัะตัะฒะตั ะฟัะธะปะพะถะตะฝะธั** (API + ะฑะพั), ะะ ะฑะฐะทะฐ ะดะฐะฝะฝัั
- ะะฐะทะฐ ะดะฐะฝะฝัั SQLite ััะฐะฝะธััั ะฝะฐ ัะพะผ ะถะต ัะตัะฒะตัะต ะฒ ัะฐะนะปะต `data/app.db`
- ะัะธะปะพะถะตะฝะธะต ัะถะต ัะฐะฑะพัะฐะตั ะฝะฐ `http://158.160.96.182:8000`

## ๐ฏ ะงัะพ ะฝัะถะฝะพ ะดะปั ะฒะตะฑ-ัะฐะทะฒะตัััะฒะฐะฝะธั

### ะะฐัะธะฐะฝั 1: ะก ะดะพะผะตะฝะพะผ (ัะตะบะพะผะตะฝะดัะตััั ะดะปั Telegram Mini App)

**ะขัะตะฑะพะฒะฐะฝะธั:**
1. โ ะะพะผะตะฝ (ะฝะฐะฟัะธะผะตั: `facy-app.ru`)
2. โ DNS ะทะฐะฟะธัั (A ะทะฐะฟะธัั โ IP: 158.160.96.182)
3. โ Nginx (reverse proxy)
4. โ SSL ัะตััะธัะธะบะฐั (Let's Encrypt) - **ะพะฑัะทะฐัะตะปัะฝะพ ะดะปั Telegram Mini App**

### ะะฐัะธะฐะฝั 2: ะะตะท ะดะพะผะตะฝะฐ (ัะพะปัะบะพ ะดะปั ัะตััะธัะพะฒะฐะฝะธั)

**ะขัะตะฑะพะฒะฐะฝะธั:**
1. โ Nginx (reverse proxy)
2. โ๏ธ ะะตะท HTTPS (Telegram Mini App ะฝะต ะฑัะดะตั ัะฐะฑะพัะฐัั!)

## ๐ ะััััะฐั ะฝะฐัััะพะนะบะฐ

### ะจะฐะณ 1: ะะฐะฟัััะธัะต ัะบัะธะฟั ะฝะฐัััะพะนะบะธ

**ะะฐ ัะตัะฒะตัะต ะฒัะฟะพะปะฝะธัะต:**

```bash
cd ~/facy-app
curl -fsSL https://raw.githubusercontent.com/ะฒะฐั-ัะตะฟะพะทะธัะพัะธะน/main/setup_web.sh | bash
```

ะะปะธ ัะบะพะฟะธััะนัะต ัะบัะธะฟั ะฝะฐ ัะตัะฒะตั:

```bash
# ะะฐ ะฒะฐัะตะผ ะบะพะผะฟัััะตัะต
scp setup_web.sh ubuntu@158.160.96.182:~/

# ะะฐ ัะตัะฒะตัะต
ssh ubuntu@158.160.96.182
chmod +x setup_web.sh
./setup_web.sh
```

### ะจะฐะณ 2: ะะฐัััะพะนัะต ะดะพะผะตะฝ (ะตัะปะธ ะตััั)

1. **ะะฐัััะพะนัะต DNS ะทะฐะฟะธัั ั ัะตะณะธัััะฐัะพัะฐ ะดะพะผะตะฝะฐ:**
   ```
   ะขะธะฟ: A
   ะะผั: @ (ะธะปะธ www)
   ะะฝะฐัะตะฝะธะต: 158.160.96.182
   TTL: 3600
   ```

2. **ะะพะถะดะธัะตัั ัะฐัะฟัะพัััะฐะฝะตะฝะธั DNS (5-30 ะผะธะฝัั)**

3. **ะัะพะฒะตัััะต DNS:**
   ```bash
   dig ะฒะฐั-ะดะพะผะตะฝ.ru
   # ะธะปะธ
   nslookup ะฒะฐั-ะดะพะผะตะฝ.ru
   ```

### ะจะฐะณ 3: ะะฐัััะพะนัะต Telegram Bot

1. ะัะบัะพะนัะต [@BotFather](https://t.me/BotFather)
2. ะัะฟัะฐะฒััะต `/mybots`
3. ะัะฑะตัะธัะต ะฒะฐัะตะณะพ ะฑะพัะฐ
4. ะัะฑะตัะธัะต **"Bot Settings"** โ **"Menu Button"**
5. ะะบะปััะธัะต **"Menu Button"**
6. ะ ะฟะพะปะต **"URL"** ะฒะฒะตะดะธัะต:
   - ะก ะดะพะผะตะฝะพะผ: `https://ะฒะฐั-ะดะพะผะตะฝ.ru`
   - ะะตะท ะดะพะผะตะฝะฐ: `http://158.160.96.182` (โ๏ธ Telegram Mini App ะฝะต ะฑัะดะตั ัะฐะฑะพัะฐัั ะฑะตะท HTTPS!)

## ๐ ะััะฝะฐั ะฝะฐัััะพะนะบะฐ (ะตัะปะธ ัะบัะธะฟั ะฝะต ัะฐะฑะพัะฐะตั)

### 1. ะฃััะฐะฝะพะฒะบะฐ Nginx

```bash
sudo apt update
sudo apt install -y nginx
```

### 2. ะกะพะทะดะฐะฝะธะต ะบะพะฝัะธะณััะฐัะธะธ

```bash
sudo nano /etc/nginx/sites-available/facy
```

ะะพะฑะฐะฒััะต:

```nginx
server {
    listen 80;
    server_name ะฒะฐั-ะดะพะผะตะฝ.ru 158.160.96.182;

    client_max_body_size 100M;

    location / {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }

    location /static/ {
        alias /home/ubuntu/facy-app/static/;
        expires 30d;
    }
    
    location /uploads/ {
        alias /home/ubuntu/facy-app/uploads/;
        expires 7d;
    }
    
    location /generated/ {
        alias /home/ubuntu/facy-app/generated/;
        expires 7d;
    }
}
```

### 3. ะะบัะธะฒะฐัะธั ะบะพะฝัะธะณััะฐัะธะธ

```bash
sudo ln -s /etc/nginx/sites-available/facy /etc/nginx/sites-enabled/
sudo rm -f /etc/nginx/sites-enabled/default
sudo nginx -t
sudo systemctl restart nginx
sudo systemctl enable nginx
```

### 4. ะฃััะฐะฝะพะฒะบะฐ SSL (ัะพะปัะบะพ ั ะดะพะผะตะฝะพะผ)

```bash
sudo apt install -y certbot python3-certbot-nginx
sudo certbot --nginx -d ะฒะฐั-ะดะพะผะตะฝ.ru
```

### 5. ะะฑะฝะพะฒะปะตะฝะธะต .env

```bash
nano .env
```

ะะทะผะตะฝะธัะต:
```env
WEBAPP_URL=https://ะฒะฐั-ะดะพะผะตะฝ.ru
# ะธะปะธ
WEBAPP_URL=http://158.160.96.182
```

### 6. ะะตัะตะทะฐะฟััะบ ะฟัะธะปะพะถะตะฝะธั

```bash
docker compose -f docker-compose.prod.yml restart
```

## โ ะัะพะฒะตัะบะฐ ัะฐะฑะพัั

1. **ะัะพะฒะตัััะต HTTP:**
   ```bash
   curl http://158.160.96.182/health
   # ะะพะปะถะฝะพ ะฒะตัะฝััััั: {"status": "healthy"}
   ```

2. **ะัะพะฒะตัััะต ะฒ ะฑัะฐัะทะตัะต:**
   - ะัะบัะพะนัะต: `http://158.160.96.182` (ะธะปะธ `https://ะฒะฐั-ะดะพะผะตะฝ.ru`)
   - ะะพะปะถะฝะฐ ะพัะบัััััั ะณะปะฐะฒะฝะฐั ัััะฐะฝะธัะฐ ะฟัะธะปะพะถะตะฝะธั

3. **ะัะพะฒะตัััะต Telegram Mini App:**
   - ะัะบัะพะนัะต ะฑะพัะฐ ะฒ Telegram
   - ะะฐะถะผะธัะต ะบะฝะพะฟะบั "๐ ะัะบัััั ะฟัะธะปะพะถะตะฝะธะต"
   - ะะพะปะถะฝะฐ ะพัะบัััััั Web App

## ๐ง ะฃะฟัะฐะฒะปะตะฝะธะต

### ะัะพัะผะพัั ะปะพะณะพะฒ Nginx

```bash
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
```

### ะะตัะตะทะฐะฟััะบ Nginx

```bash
sudo systemctl restart nginx
```

### ะัะพะฒะตัะบะฐ ััะฐัััะฐ

```bash
sudo systemctl status nginx
```

### ะะฑะฝะพะฒะปะตะฝะธะต SSL ัะตััะธัะธะบะฐัะฐ

```bash
sudo certbot renew
```

## ๐ ะะตัะตะฝะธะต ะฟัะพะฑะปะตะผ

### ะัะพะฑะปะตะผะฐ: Nginx ะฝะต ะทะฐะฟััะบะฐะตััั

```bash
# ะัะพะฒะตัััะต ะบะพะฝัะธะณััะฐัะธั
sudo nginx -t

# ะัะพะฒะตัััะต ะปะพะณะธ
sudo tail -f /var/log/nginx/error.log
```

### ะัะพะฑะปะตะผะฐ: 502 Bad Gateway

```bash
# ะัะพะฒะตัััะต, ััะพ API ัะฐะฑะพัะฐะตั
curl http://localhost:8000/health

# ะัะพะฒะตัััะต ะปะพะณะธ Docker
docker compose -f docker-compose.prod.yml logs api
```

### ะัะพะฑะปะตะผะฐ: SSL ะฝะต ัะฐะฑะพัะฐะตั

```bash
# ะัะพะฒะตัััะต DNS
dig ะฒะฐั-ะดะพะผะตะฝ.ru

# ะัะพะฒะตัััะต ัะตััะธัะธะบะฐั
sudo certbot certificates

# ะะฑะฝะพะฒะธัะต ัะตััะธัะธะบะฐั
sudo certbot renew --force-renewal
```

## ๐ ะะฐะถะฝัะต ะทะฐะผะตัะฐะฝะธั

1. **Telegram Mini App ััะตะฑัะตั HTTPS** - ะฑะตะท SSL ัะตััะธัะธะบะฐัะฐ Mini App ะฝะต ะฑัะดะตั ัะฐะฑะพัะฐัั
2. **ะะปั ะฟัะพะดะฐะบัะตะฝะฐ ัะตะบะพะผะตะฝะดัะตััั ะธัะฟะพะปัะทะพะฒะฐัั ะดะพะผะตะฝ** - ััะพ ะฑะพะปะตะต ะฝะฐะดะตะถะฝะพ ะธ ะฑะตะทะพะฟะฐัะฝะพ
3. **Nginx ัะฐะฑะพัะฐะตั ะฝะฐ ะฟะพััะฐั 80 (HTTP) ะธ 443 (HTTPS)** - ัะฑะตะดะธัะตัั, ััะพ ััะธ ะฟะพััั ะพัะบัััั ะฒ ะณััะฟะฟะฐั ะฑะตะทะพะฟะฐัะฝะพััะธ ะฏะฝะดะตะบั.ะะฑะปะฐะบะฐ
4. **API ะพััะฐะตััั ะฝะฐ ะฟะพััั 8000** - Nginx ะฟัะพะบัะธััะตั ะทะฐะฟัะพัั ั 80/443 ะฝะฐ 8000

## ๐ ะะพัะพะฒะพ!

ะะพัะปะต ะฝะฐัััะพะนะบะธ ะฒะฐัะต ะฟัะธะปะพะถะตะฝะธะต ะฑัะดะตั ะดะพัััะฟะฝะพ:
- ะะฐะบ ะฒะตะฑ-ัะฐะนั: `http://158.160.96.182` ะธะปะธ `https://ะฒะฐั-ะดะพะผะตะฝ.ru`
- ะะฐะบ Telegram Mini App: ัะตัะตะท ะบะฝะพะฟะบั ะฒ ะฑะพัะต


