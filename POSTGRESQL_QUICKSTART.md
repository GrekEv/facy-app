# üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: PostgreSQL –≤ –Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–µ

## ‚ö° –ó–∞ 5 —à–∞–≥–æ–≤

### –®–∞–≥ 1: –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Ç–µ—Ä PostgreSQL (5 –º–∏–Ω—É—Ç)

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://cloud.yandex.ru
2. **Managed Databases** ‚Üí **PostgreSQL** ‚Üí **–°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Ç–µ—Ä**
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∏:
   - **–ò–º—è:** `facy-postgresql`
   - **–ö–ª–∞—Å—Å —Ö–æ—Å—Ç–∞:** `s2.micro` (2 vCPU, 8 GB) - –æ—Ç 500‚ÇΩ/–º–µ—Å
   - **–î–∏—Å–∫:** 20 GB SSD
   - **–ò–º—è –ë–î:** `facy_db`
   - **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** `facy_user`
   - **–ü–∞—Ä–æ–ª—å:** –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–∞–¥–µ–∂–Ω—ã–π (—Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ!)
   - **–ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø:** ‚úÖ –í–∫–ª—é—á–∏—Ç—å
4. –ù–∞–∂–º–∏—Ç–µ **"–°–æ–∑–¥–∞—Ç—å"**
5. –î–æ–∂–¥–∏—Ç–µ—Å—å —Å–æ–∑–¥–∞–Ω–∏—è (5-10 –º–∏–Ω—É—Ç)

### –®–∞–≥ 2: –ü–æ–ª—É—á–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä
2. –í–∫–ª–∞–¥–∫–∞ **"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ"**
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ:
   - **–•–æ—Å—Ç:** `c-xxxxx.rw.mdb.yandexcloud.net`
   - **–ü–æ—Ä—Ç:** `6432`
   - **–ë–î:** `facy_db`
   - **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** `facy_user`
   - **–ü–∞—Ä–æ–ª—å:** (–≤–∞—à –ø–∞—Ä–æ–ª—å)

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≥—Ä—É–ø–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. –í –∫–ª–∞—Å—Ç–µ—Ä–µ: **"–ì—Ä—É–ø–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"**
2. –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∏–ª–æ:
   - **–ü–æ—Ä—Ç:** `6432`
   - **–ò—Å—Ç–æ—á–Ω–∏–∫:** IP –≤–∞—à–µ–π –í–ú `158.160.96.182` –∏–ª–∏ –ø–æ–¥—Å–µ—Ç—å

### –®–∞–≥ 4: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:**

```bash
cd ~/facy-app

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω)
# –ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –≤—Ä—É—á–Ω—É—é –∏–∑ setup_postgresql.sh

chmod +x setup_postgresql.sh
./setup_postgresql.sh
```

**–°–∫—Ä–∏–ø—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç:**
- –•–æ—Å—Ç (FQDN)
- –ü–æ—Ä—Ç (6432)
- –ò–º—è –ë–î (facy_db)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (facy_user)
- –ü–∞—Ä–æ–ª—å

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker compose -f docker-compose.prod.yml logs api --tail=50

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ health
curl http://localhost:8000/health

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
docker compose -f docker-compose.prod.yml ps
```

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –æ–±–ª–∞–∫–µ
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏
- ‚úÖ –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é

## üìã –§–æ—Ä–º–∞—Ç —Å—Ç—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```
postgresql+asyncpg://USER:PASSWORD@HOST:PORT/DATABASE?ssl=require
```

**–ü—Ä–∏–º–µ—Ä:**
```
postgresql+asyncpg://facy_user:MyPass123@c-9q1234567890.rw.mdb.yandexcloud.net:6432/facy_db?ssl=require
```

## üîß –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–µ—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

### 1. –û–±–Ω–æ–≤–∏—Ç–µ requirements.txt

```bash
echo "asyncpg==0.29.0  # –î–ª—è PostgreSQL" >> requirements.txt
```

### 2. –û–±–Ω–æ–≤–∏—Ç–µ .env

```bash
nano .env
```

–ò–∑–º–µ–Ω–∏—Ç–µ:
```env
DATABASE_URL=postgresql+asyncpg://facy_user:–í–ê–®_–ü–ê–†–û–õ–¨@c-xxxxx.rw.mdb.yandexcloud.net:6432/facy_db?ssl=require
```

### 3. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ

```bash
docker compose -f docker-compose.prod.yml build --no-cache
docker compose -f docker-compose.prod.yml down
docker compose -f docker-compose.prod.yml up -d
```

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å

- **–ú–∏–Ω–∏–º—É–º:** s2.micro (2 vCPU, 8 GB) - –æ—Ç ~500‚ÇΩ/–º–µ—Å—è—Ü
- **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** s2.small (4 vCPU, 16 GB) - –æ—Ç ~1000‚ÇΩ/–º–µ—Å—è—Ü
- **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥:** –ü–µ—Ä–≤—ã–µ 60 –¥–Ω–µ–π (–µ—Å–ª–∏ –µ—Å—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞)

## üìö –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

–°–º. [POSTGRESQL_SETUP.md](POSTGRESQL_SETUP.md) –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.

